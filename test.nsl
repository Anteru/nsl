struct TransformationMatrices
{
	uint applyOffset[3];
	matrix4x4 matrices[3];
	float4 offset[3];
}

struct TransformInfo
{
	uint pointsToTransform;
	TransformationMatrices transforms[32];
}

float4 inputPositions[32];
float4 outputPositions[32];

function TransformPoint(float4 p, TransformationMatrices m) -> float4
{
	for (int i = 0; i < 3; ++i) {
		p = m.matrices[i] * p;
	}

	for (uint i = 0; i < 3; ++i) {
		if (m.applyOffset[i]) {
			p += m.offset[i];
		}
	}

	return p;
}

function Transform(TransformInfo info) -> void
{
	for (int i = 0; i < info.pointsToTransform; ++i) {
		outputPositions[i] = TransformPoint (inputPositions[i], info.transforms[i]);
	}
}
